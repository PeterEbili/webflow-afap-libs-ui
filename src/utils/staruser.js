"use strict";(()=>{var A="https://afap.app",s={verify:"Verify",lib:"Library",star:"Star",token:"Token",store:"Store",keyof:"key",af:"AF",access:"Access",memeeker:{from:{},to:{},element:document.querySelector("meta")||document.querySelector("head"),duration:0}};var x="AFAP",c=s.star+s.store,_=1;function b(){return new Promise((t,r)=>{let e=indexedDB.open(x,_);e.onupgradeneeded=()=>{let o=e.result;o.objectStoreNames.contains(c)||o.createObjectStore(c)},e.onsuccess=()=>t(e.result),e.onerror=()=>r(e.error)})}async function i(t,r){let e=await b();return new Promise((o,n)=>{let m=e.transaction(c,"readwrite").objectStore(c).put(r,t);m.onsuccess=()=>o(),m.onerror=()=>n(m.error)})}async function y(t){let r=await b();return new Promise((e,o)=>{let a=r.transaction(c,"readonly").objectStore(c).get(t);a.onsuccess=()=>e(a.result),a.onerror=()=>o(a.error)})}var l=new TextEncoder,B=new TextDecoder,T="e0nxgjl14fg";async function g(){let t=await crypto.subtle.importKey("raw",l.encode(T),{name:"PBKDF2"},!1,["deriveKey"]);return crypto.subtle.deriveKey({name:"PBKDF2",salt:l.encode("unique-salt"),iterations:1e5,hash:"SHA-256"},t,{name:"AES-GCM",length:256},!1,["encrypt","decrypt"])}async function d(t){let r=await g(),e=crypto.getRandomValues(new Uint8Array(12)),o=await crypto.subtle.encrypt({name:"AES-GCM",iv:e},r,l.encode(t)),n=new Uint8Array([...e,...new Uint8Array(o)]);return btoa(String.fromCharCode(...n))}async function p(t){let r=Uint8Array.from(atob(t),a=>a.charCodeAt(0)),e=r.slice(0,12),o=r.slice(12),n=await g(),f=await crypto.subtle.decrypt({name:"AES-GCM",iv:e},n,o);return B.decode(f)}var u=s.lib+s.star+s.token,E=24,k=A+"/"+s.verify.toLowerCase()+"-"+s.access.toLowerCase()+"-"+s.keyof+"/";async function S(t){try{let r=await fetch(k+t,{method:"GET",headers:{"Content-Type":"application/json"}});if(r.ok)return(await r.json()).status}catch{return!1}return!1}async function w(){let t="";try{let r=await y(u);if(r){let e=await p(r);t=JSON.parse(e).key}}catch(r){console.error(r)}return window.STARUSER_LIB_KEY_AFAP=t,t}async function P(t){let r={key:t,expiry:Date.now()+E*60*60*1e3};try{let e=await d(JSON.stringify(r));return await i(u,e),!0}catch(e){console.log(e)}return!1}async function K(){let t=window.STARUSER_LIB_KEY_AFAP||await w();if(!t)return!1;try{let e=await y(u);if(e){let o=await p(e),n=JSON.parse(o);if(n.key===t&&Date.now()<n.expiry)return!0}}catch{}let r=await S(t);if(r){let e={key:t,expiry:Date.now()+E*60*60*1e3},o=await d(JSON.stringify(e));await i(u,o)}return r}function R(){let t=window.STARUSER_LIB_KEY_AFAP||"";if(!t){let r=`${s.af.toLowerCase()}-premium`,e=document.querySelector(`[${r}]`);if(e){let o=e.getAttribute(r);o&&(t=o)}}if(!t){let r=document.querySelectorAll("script[src]");for(let e of r){let n=e.getAttribute("src").match(/[\?\&]afapkey=([^\&]+)/);if(n&&n[1]){t=n[1].toString();break}}}return window.STARUSER_LIB_KEY_AFAP=t,t}R();window.StarUserAfapist={hasStarAccess:K,confirmSuperStarAccess:S,getStarKeyFromDB:w,saveStarKeyToDB:P,dbGet:y,dbSet:i,decrypt:p,encrypt:d};})();
